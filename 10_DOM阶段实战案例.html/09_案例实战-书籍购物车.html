<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        table {
            border-collapse: collapse;
            background-color: #f5f5f5;
        }

        th,
        td {
            border: 1px solid #aaa;
            padding: 8px 12px;

            text-align: center;
        }
    </style>
</head>

<body>
    <table>
        <thead>
            <tr>
                <th>编号</th>
                <th>书籍名称</th>
                <th>出版日期</th>
                <th>价格</th>
                <th>购买数量</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
    <h2 class="total">
        总价格：¥<span class="price-count">0</span>
    </h2>

    <script>
        //1.从服务器获取数据 Ajax/fetch
        var books = [
            {
                id: "1",
                name: "《算法导论》",
                date: '2006-09',
                price: "05.00",
                count: 3
            },
            {
                id: "2",
                name: "《unix编程艺术》",
                date: '2006-02',
                price: "05.00",
                count: 3
            },
            {
                id: "3",
                name: "《编程珠玑》",
                date: '2006-09',
                price: "05.00",
                count: 3
            },
            {
                id: "4",
                name: "《代码大全》",
                date: '2006-04',
                price: "05.00",
                count: 3
            },
            {
                id: "5",
                name: "《前端开发》",
                date: '2006-08',
                price: "05.00",
                count: 3
            },
            {
                id: "6",
                name: "《红宝书》",
                date: '2006-01',
                price: "05.00",
                count: 3
            },
        ]


        //2.1 对数据遍历展示
        var tbodyEl = document.querySelector("tbody")
        //2.2动态添加tr以及内部数据
        for (var i = 0; i < books.length; i++) {
            var trowEl = document.createElement("tr")


            //2.3放具体数据
            var book = books[i]
            var bookKeys = Object.keys(book)
            for (var m = 0; m < bookKeys.length; m++) {
                var key = bookKeys[m]
                var value = book[key]
                var tdEl = document.createElement("td")

                if (key === "price") {
                    value = "¥" + value
                }

                tdEl.textContent = value
                trowEl.append(tdEl)
            }
            //2.4.删除按钮
            var deteleTdEl = document.createElement("td")
            var deteleBtnEl = document.createElement("button")
            deteleBtnEl.textContent = "删除"

            deteleTdEl.append(deteleBtnEl)
            trowEl.append(deteleTdEl)

            //2.5监听按钮的点击
            deteleBtnEl.onclick = function () {
                //1.删除对应的row

                var deteleTrowEl = this.parentElement.parentElement
                var deteleTrIndex = deteleTrowEl.sectionRowIndex //拿到对应的索引
                deteleTrowEl.remove()
                //2.删除对应books中的数据
                books.splice(deteleTrIndex, 1)


                //3.重新计算一次价格
                calcTotalPrice()
            }

            tbodyEl.append(trowEl)

        }

        //3计算总价格
        var priceCountEl = document.querySelector(".price-count")

        //3.1 方法一
        // var totalPrice = 0;
        // for (var i = 0; i < books.length; i++) {
        //     totalPrice += books[i].count * books[i].price
        // }
        // priceCountEl.textContent = totalPrice
        //3.2 方法二
        var totalPrice = books.reduce(function (preValue, item) {
            return preValue + item.count * item.price
        }, 0)
        priceCountEl.textContent = totalPrice


        //4.封装计算总价格函数
        function calcTotalPrice() {
            var totalPrice = books.reduce(function (preValue, item) {
                return preValue + item.count * item.price
            }, 0)

            priceCountEl.textContent = totalPrice
        }

    </script>

















</body>

</html>